# ä½¿ç”¨ Effect åŒæ­¥
æœ‰äº›ç»„ä»¶éœ€è¦ä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›æ ¹æ® React state æ§åˆ¶é React ç»„ä»¶ã€è®¾ç½®æœåŠ¡å™¨è¿æ¥æˆ–åœ¨ç»„ä»¶å‡ºç°åœ¨å±å¹•ä¸Šæ—¶å‘é€åˆ†ææ—¥å¿—ã€‚Effects ä¼šåœ¨æ¸²æŸ“åè¿è¡Œä¸€äº›ä»£ç ï¼Œä»¥ä¾¿å¯ä»¥å°†ç»„ä»¶ä¸ React ä¹‹å¤–çš„æŸäº›ç³»ç»ŸåŒæ­¥ã€‚

## ä½ å°†ä¼šå­¦ä¹ åˆ°
+ ä»€ä¹ˆæ˜¯ Effect
+ Effect ä¸äº‹ä»¶ï¼ˆeventï¼‰æœ‰ä½•ä¸åŒ
+ å¦‚ä½•åœ¨ç»„ä»¶ä¸­å£°æ˜ Effect
+ å¦‚ä½•é¿å…ä¸å¿…è¦åœ°é‡æ–°è¿è¡Œ Effect
+ ä¸ºä»€ä¹ˆ Effect åœ¨å¼€å‘ç¯å¢ƒä¸­ä¼šå½±å“ä¸¤æ¬¡ï¼Œå¦‚ä½•ä¿®å¤å®ƒä»¬

## ä»€ä¹ˆæ˜¯ Effectï¼Œå®ƒä¸äº‹ä»¶ï¼ˆeventï¼‰æœ‰ä½•ä¸åŒï¼Ÿ 
åœ¨è°ˆåˆ° Effect ä¹‹å‰ï¼Œä½ éœ€è¦ç†Ÿæ‚‰ React ç»„ä»¶ä¸­çš„ä¸¤ç§é€»è¾‘ç±»å‹ï¼š
+ æ¸²æŸ“é€»è¾‘ä»£ç ï¼ˆåœ¨ æè¿° UI ä¸­æœ‰ä»‹ç»ï¼‰ä½äºç»„ä»¶çš„é¡¶å±‚ã€‚ä½ å°†åœ¨è¿™é‡Œæ¥æ”¶ props å’Œ stateï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œè½¬æ¢ï¼Œæœ€ç»ˆè¿”å›ä½ æƒ³åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„ JSXã€‚æ¸²æŸ“çš„ä»£ç å¿…é¡»æ˜¯çº¯ç²¹çš„â€”â€”å°±åƒæ•°å­¦å…¬å¼ä¸€æ ·ï¼Œå®ƒåªåº”è¯¥â€œè®¡ç®—â€ç»“æœï¼Œè€Œä¸åšå…¶ä»–ä»»ä½•äº‹æƒ…ã€‚
+ äº‹ä»¶å¤„ç†ç¨‹åºï¼ˆåœ¨ æ·»åŠ äº¤äº’æ€§ ä¸­ä»‹ç»ï¼‰æ˜¯åµŒå¥—åœ¨ç»„ä»¶å†…éƒ¨çš„å‡½æ•°ï¼Œè€Œä¸ä»…ä»…æ˜¯è®¡ç®—å‡½æ•°ã€‚äº‹ä»¶å¤„ç†ç¨‹åºå¯èƒ½ä¼šæ›´æ–°è¾“å…¥å­—æ®µã€æäº¤ HTTP POST è¯·æ±‚ä»¥è´­ä¹°äº§å“ï¼Œæˆ–è€…å°†ç”¨æˆ·å¯¼èˆªåˆ°å¦ä¸€ä¸ªå±å¹•ã€‚äº‹ä»¶å¤„ç†ç¨‹åºåŒ…å«ç”±ç‰¹å®šç”¨æˆ·æ“ä½œï¼ˆä¾‹å¦‚æŒ‰é’®ç‚¹å‡»æˆ–é”®å…¥ï¼‰å¼•èµ·çš„â€œå‰¯ä½œç”¨â€ï¼ˆå®ƒä»¬æ”¹å˜äº†ç¨‹åºçš„çŠ¶æ€ï¼‰ã€‚

æœ‰æ—¶è¿™è¿˜ä¸å¤Ÿã€‚è€ƒè™‘ä¸€ä¸ª `ChatRoom` ç»„ä»¶ï¼Œå®ƒåœ¨å±å¹•ä¸Šå¯è§æ—¶å¿…é¡»è¿æ¥åˆ°èŠå¤©æœåŠ¡å™¨ã€‚è¿æ¥åˆ°æœåŠ¡å™¨ä¸æ˜¯ä¸€ä¸ªçº¯è®¡ç®—ï¼ˆå®ƒåŒ…å«å‰¯ä½œç”¨ï¼‰ï¼Œå› æ­¤å®ƒä¸èƒ½åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å‘ç”Ÿã€‚ç„¶è€Œï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªç‰¹å®šçš„äº‹ä»¶ï¼ˆæ¯”å¦‚ç‚¹å‡»ï¼‰å¯¼è‡´ ChatRoom è¢«æ˜¾ç¤ºã€‚

*Effect å…è®¸ä½ æŒ‡å®šç”±æ¸²æŸ“æœ¬èº«ï¼Œè€Œä¸æ˜¯ç‰¹å®šäº‹ä»¶å¼•èµ·çš„å‰¯ä½œç”¨*ã€‚åœ¨èŠå¤©ä¸­å‘é€æ¶ˆæ¯æ˜¯ä¸€ä¸ªâ€œäº‹ä»¶â€ï¼Œå› ä¸ºå®ƒç›´æ¥ç”±ç”¨æˆ·ç‚¹å‡»ç‰¹å®šæŒ‰é’®å¼•èµ·ã€‚ç„¶è€Œï¼Œå»ºç«‹æœåŠ¡å™¨è¿æ¥æ˜¯ Effectï¼Œå› ä¸ºå®ƒåº”è¯¥å‘ç”Ÿæ— è®ºå“ªç§äº¤äº’å¯¼è‡´ç»„ä»¶å‡ºç°ã€‚Effect åœ¨å±å¹•æ›´æ–°åçš„ æäº¤é˜¶æ®µ è¿è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ—¶æœºï¼Œå¯ä»¥å°† React ç»„ä»¶ä¸æŸä¸ªå¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚ç½‘ç»œæˆ–ç¬¬ä¸‰æ–¹åº“ï¼‰åŒæ­¥ã€‚

## æ³¨æ„
åœ¨æœ¬æ–‡å’Œåç»­æ–‡æœ¬ä¸­ï¼Œ`Effect` åœ¨ React ä¸­æ˜¯ä¸“æœ‰å®šä¹‰â€”â€”ç”±æ¸²æŸ“å¼•èµ·çš„å‰¯ä½œç”¨ã€‚ä¸ºäº†æŒ‡ä»£æ›´å¹¿æ³›çš„ç¼–ç¨‹æ¦‚å¿µï¼Œä¹Ÿå¯ä»¥å°†å…¶ç§°ä¸ºâ€œå‰¯ä½œç”¨ï¼ˆside effectï¼‰â€ã€‚

## ä½ å¯èƒ½ä¸éœ€è¦ Effect 
*ä¸è¦éšæ„åœ¨ä½ çš„ç»„ä»¶ä¸­ä½¿ç”¨ Effect*ã€‚è®°ä½ï¼ŒEffect é€šå¸¸ç”¨äºæš‚æ—¶â€œè·³å‡ºâ€ React ä»£ç å¹¶ä¸ä¸€äº› å¤–éƒ¨ ç³»ç»Ÿè¿›è¡ŒåŒæ­¥ã€‚è¿™åŒ…æ‹¬æµè§ˆå™¨ APIã€ç¬¬ä¸‰æ–¹å°éƒ¨ä»¶ï¼Œä»¥åŠç½‘ç»œç­‰ç­‰ã€‚å¦‚æœä½ æƒ³ç”¨ Effect ä»…æ ¹æ®å…¶ä»–çŠ¶æ€è°ƒæ•´æŸäº›çŠ¶æ€ï¼Œé‚£ä¹ˆ ä½ å¯èƒ½ä¸éœ€è¦ Effectã€‚

## å¦‚ä½•ç¼–å†™ Effect 
ç¼–å†™ Effect éœ€è¦éµå¾ªä»¥ä¸‹ä¸‰ä¸ªè§„åˆ™ï¼š

1. *å£°æ˜ Effect*ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒEffect ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œã€‚
2. *æŒ‡å®š Effect ä¾èµ–*ã€‚å¤§å¤šæ•° Effect åº”è¯¥æŒ‰éœ€æ‰§è¡Œï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œæ·¡å…¥åŠ¨ç”»åº”è¯¥åªåœ¨ç»„ä»¶å‡ºç°æ—¶è§¦å‘ã€‚è¿æ¥å’Œæ–­å¼€æœåŠ¡å™¨çš„æ“ä½œåªåº”åœ¨ç»„ä»¶å‡ºç°å’Œæ¶ˆå¤±æ—¶ï¼Œæˆ–è€…åˆ‡æ¢èŠå¤©å®¤æ—¶æ‰§è¡Œã€‚æ–‡ç« å°†ä»‹ç»å¦‚ä½•é€šè¿‡æŒ‡å®šä¾èµ–æ¥æ§åˆ¶å¦‚ä½•æŒ‰éœ€æ‰§è¡Œã€‚
3. *å¿…è¦æ—¶æ·»åŠ æ¸…ç†ï¼ˆ`cleanup`ï¼‰å‡½æ•°*ã€‚æœ‰æ—¶ Effect éœ€è¦æŒ‡å®šå¦‚ä½•åœæ­¢ã€æ’¤é”€ï¼Œæˆ–è€…æ¸…é™¤å®ƒçš„æ•ˆæœã€‚ä¾‹å¦‚ï¼Œâ€œè¿æ¥â€æ“ä½œéœ€è¦â€œæ–­è¿â€ï¼Œâ€œè®¢é˜…â€éœ€è¦â€œé€€è®¢â€ï¼Œâ€œè·å–â€æ—¢éœ€è¦â€œå–æ¶ˆâ€ä¹Ÿéœ€è¦â€œå¿½ç•¥â€ã€‚ä½ å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ æ¸…ç†å‡½æ•° æ¥åšåˆ°è¿™ä¸€åˆ‡ã€‚

ä»¥ä¸‹æ˜¯å…·ä½“æ­¥éª¤ã€‚

### ç¬¬ä¸€æ­¥ï¼šå£°æ˜ Effect 
é¦–å…ˆåœ¨ React ä¸­å¼•å…¥ `useEffect` Hookï¼š

```jsx
import { useEffect } from 'react';
```

ç„¶åï¼Œåœ¨ç»„ä»¶é¡¶éƒ¨è°ƒç”¨å®ƒï¼Œå¹¶ä¼ å…¥åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½éœ€è¦æ‰§è¡Œçš„ä»£ç ï¼š

```jsx
function MyComponent() {
  useEffect(() => {
    // æ¯æ¬¡æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œæ­¤å¤„çš„ä»£ç 
  });
  return <div />;
}
```

æ¯å½“ä½ çš„ç»„ä»¶æ¸²æŸ“æ—¶ï¼ŒReact å°†æ›´æ–°å±å¹•ï¼Œç„¶åè¿è¡Œ `useEffect` ä¸­çš„ä»£ç ã€‚æ¢å¥è¯è¯´ï¼Œ`useEffect` ä¼šæŠŠè¿™æ®µä»£ç æ”¾åˆ° *å±å¹•æ›´æ–°æ¸²æŸ“ä¹‹å* æ‰§è¡Œã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Effect ä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥ã€‚è€ƒè™‘ä¸€ä¸ª `<VideoPlayer>` React ç»„ä»¶ã€‚é€šè¿‡ä¼ é€’å¸ƒå°”ç±»å‹çš„ `isPlaying` prop ä»¥æ§åˆ¶æ˜¯æ’­æ”¾è¿˜æ˜¯æš‚åœï¼š

```jsx
<VideoPlayer isPlaying={isPlaying} />;
```

è‡ªå®šä¹‰çš„ `VideoPlayer` ç»„ä»¶æ¸²æŸ“äº†å†…ç½®çš„ `<video>` æ ‡ç­¾ï¼š

```jsx
function VideoPlayer({ src, isPlaying }) {
  // TODOï¼šä½¿ç”¨ isPlaying åšä¸€äº›äº‹æƒ…
  return <video src={src} />;
}
```

ä½†æ˜¯ï¼Œæµè§ˆå™¨çš„ `<video>` æ ‡ç­¾æ²¡æœ‰ `isPlaying` å±æ€§ã€‚æ§åˆ¶å®ƒçš„å”¯ä¸€æ–¹å¼æ˜¯åœ¨ DOM å…ƒç´ ä¸Šè°ƒç”¨ `play()` å’Œ `pause()` æ–¹æ³•ã€‚å› æ­¤ï¼Œä½ éœ€è¦å°† `isPlaying` prop çš„å€¼ä¸ `play()` å’Œ `pause()` ç­‰å‡½æ•°çš„è°ƒç”¨è¿›è¡ŒåŒæ­¥ï¼Œè¯¥å±æ€§ç”¨äºå‘ŠçŸ¥å½“å‰è§†é¢‘æ˜¯å¦åº”è¯¥æ’­æ”¾ã€‚

é¦–å…ˆè¦è·å– `<video>` DOM èŠ‚ç‚¹çš„ å¯¹è±¡å¼•ç”¨ã€‚

ä½ å¯èƒ½ä¼šå°è¯•åœ¨æ¸²æŸ“æœŸé—´è°ƒç”¨ `play()` æˆ– `pause()`ï¼Œä½†è¿™ç§åšæ³•æ˜¯é”™çš„ï¼š

```jsx
import { useState, useRef, useEffect } from 'react';

function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);

  if (isPlaying) {
    ref.current.play();  // æ¸²æŸ“æœŸé—´ä¸èƒ½è°ƒç”¨ `play()`ã€‚ 
  } else {
    ref.current.pause(); // åŒæ ·ï¼Œè°ƒç”¨ `pause()` ä¹Ÿä¸è¡Œã€‚
  }

  return <video ref={ref} src={src} loop playsInline />;
}

export default function App() {
  const [isPlaying, setIsPlaying] = useState(false);
  return (
    <>
      <button onClick={() => setIsPlaying(!isPlaying)}>
        {isPlaying ? 'æš‚åœ' : 'æ’­æ”¾'}
      </button>
      <VideoPlayer
        isPlaying={isPlaying}
        src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      />
    </>
  );
}
```

è¿™æ®µä»£ç ä¹‹æ‰€ä»¥ä¸æ­£ç¡®ï¼Œæ˜¯å› ä¸ºå®ƒè¯•å›¾åœ¨æ¸²æŸ“æœŸé—´å¯¹ DOM èŠ‚ç‚¹è¿›è¡Œæ“ä½œã€‚åœ¨ React ä¸­ï¼ŒJSX çš„æ¸²æŸ“å¿…é¡»æ˜¯çº¯ç²¹æ“ä½œï¼Œä¸åº”è¯¥åŒ…å«ä»»ä½•åƒä¿®æ”¹ DOM çš„å‰¯ä½œç”¨ã€‚

è€Œä¸”ï¼Œå½“ç¬¬ä¸€æ¬¡è°ƒç”¨ `VideoPlayer` æ—¶ï¼Œå¯¹åº”çš„ DOM èŠ‚ç‚¹ç”šè‡³è¿˜ä¸å­˜åœ¨ï¼å¦‚æœè¿ DOM èŠ‚ç‚¹éƒ½æ²¡æœ‰ï¼Œé‚£ä¹ˆå¦‚ä½•è°ƒç”¨ `play()` æˆ– `pause()` æ–¹æ³•å‘¢ï¼åœ¨è¿”å› JSX ä¹‹å‰ï¼ŒReact ä¸çŸ¥é“è¦åˆ›å»ºä»€ä¹ˆ DOMã€‚

è§£å†³åŠæ³•æ˜¯ ä½¿ç”¨ `useEffect` åŒ…è£¹å‰¯ä½œç”¨ï¼Œ*æŠŠå®ƒåˆ†ç¦»åˆ°æ¸²æŸ“é€»è¾‘çš„è®¡ç®—è¿‡ç¨‹ä¹‹å¤–*ï¼š

```jsx
import { useEffect, useRef } from 'react';

function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);

  useEffect(() => {
    if (isPlaying) {
      ref.current.play();
    } else {
      ref.current.pause();
    }
  });

  return <video ref={ref} src={src} loop playsInline />;
}
```

æŠŠè°ƒç”¨ DOM æ–¹æ³•çš„æ“ä½œå°è£…åœ¨ Effect ä¸­ï¼Œä½ å¯ä»¥è®© React å…ˆæ›´æ–°å±å¹•ï¼Œç¡®å®šç›¸å…³ DOM åˆ›å»ºå¥½äº†ä»¥åç„¶åå†è¿è¡Œ Effectã€‚

å½“ `VideoPlayer` ç»„ä»¶æ¸²æŸ“æ—¶ï¼ˆæ— è®ºæ˜¯å¦ä¸ºé¦–æ¬¡æ¸²æŸ“ï¼‰ï¼Œéƒ½ä¼šå‘ç”Ÿä»¥ä¸‹äº‹æƒ…ã€‚é¦–å…ˆï¼ŒReact ä¼šåˆ·æ–°å±å¹•ï¼Œç¡®ä¿ `<video>` å…ƒç´ å·²ç»æ­£ç¡®åœ°å‡ºç°åœ¨ DOM ä¸­ï¼›ç„¶åï¼ŒReact å°†è¿è¡Œ Effectï¼›æœ€åï¼ŒEffect å°†æ ¹æ® `isPlaying` çš„å€¼è°ƒç”¨ `play()` æˆ– `pause()`ã€‚

è¯•è¯•æŒ‰ä¸‹å‡ æ¬¡æ’­æ”¾å’Œæš‚åœæ“ä½œï¼Œè§‚å¯Ÿè§†é¢‘æ’­æ”¾å™¨çš„æ’­æ”¾ã€æš‚åœè¡Œä¸ºæ˜¯å¦‚ä½•ä¸ `isPlaying` prop åŒæ­¥çš„ï¼š

```jsx
import { useState, useRef, useEffect } from 'react';

function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);

  useEffect(() => {
    if (isPlaying) {
      ref.current.play();
    } else {
      ref.current.pause();
    }
  });

  return <video ref={ref} src={src} loop playsInline />;
}

export default function App() {
  const [isPlaying, setIsPlaying] = useState(false);
  return (
    <>
      <button onClick={() => setIsPlaying(!isPlaying)}>
        {isPlaying ? 'æš‚åœ' : 'æ’­æ”¾'}
      </button>
      <VideoPlayer
        isPlaying={isPlaying}
        src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      />
    </>
  );
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½ åŒæ­¥åˆ° React `state` çš„â€œå¤–éƒ¨ç³»ç»Ÿâ€æ˜¯æµè§ˆå™¨åª’ä½“ APIï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„æ–¹æ³•å°†æ—§çš„é React ä»£ç ï¼ˆå¦‚ jQuery æ’ä»¶ï¼‰å°è£…æˆå£°æ˜æ€§çš„ React ç»„ä»¶ã€‚

è¯·æ³¨æ„ï¼Œæ§åˆ¶è§†é¢‘æ’­æ”¾å™¨åœ¨å®é™…åº”ç”¨ä¸­å¤æ‚å¾—å¤šï¼šæ¯”å¦‚è°ƒç”¨ `play()` å¯èƒ½ä¼šå¤±è´¥ï¼Œç”¨æˆ·å¯èƒ½ä¼šä½¿ç”¨å†…ç½®æµè§ˆå™¨æ§ä»¶æ’­æ”¾æˆ–æš‚åœç­‰ç­‰ã€‚è¿™åªæ˜¯ä¸€ä¸ªç®€åŒ–äº†å¾ˆå¤šå…·ä½“ç»†èŠ‚çš„ä¾‹å­ã€‚

### é™·é˜±
ä¸€èˆ¬æ¥è¯´ï¼ŒEffect ä¼šåœ¨ *æ¯æ¬¡* æ¸²æŸ“åæ‰§è¡Œï¼Œ*è€Œä»¥ä¸‹ä»£ç ä¼šé™·å…¥æ­»å¾ªç¯ä¸­*ï¼š

```jsx
const [count, setCount] = useState(0);
useEffect(() => {
  setCount(count + 1);
});
```

æ¯æ¬¡æ¸²æŸ“ç»“æŸéƒ½ä¼šæ‰§è¡Œ Effectï¼›è€Œæ›´æ–° `state` ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚ä½†æ˜¯æ–°ä¸€è½®æ¸²æŸ“æ—¶åˆä¼šå†æ¬¡æ‰§è¡Œ Effectï¼Œç„¶å Effect å†æ¬¡æ›´æ–° `state`â€¦â€¦ å¦‚æ­¤å‘¨è€Œå¤å§‹ï¼Œä»è€Œé™·å…¥æ­»å¾ªç¯ã€‚
Effect é€šå¸¸åº”è¯¥ä½¿ç»„ä»¶ä¸ å¤–éƒ¨ ç³»ç»Ÿä¿æŒåŒæ­¥ã€‚å¦‚æœæ²¡æœ‰å¤–éƒ¨ç³»ç»Ÿï¼Œä½ åªæƒ³æ ¹æ®å…¶ä»–çŠ¶æ€è°ƒæ•´ä¸€äº›çŠ¶æ€ï¼Œé‚£ä¹ˆ ä½ ä¹Ÿè®¸ä¸éœ€è¦ Effectã€‚

### ç¬¬äºŒæ­¥ï¼šæŒ‡å®š Effect ä¾èµ– 
ä¸€èˆ¬æ¥è¯´ï¼ŒEffect ä¼šåœ¨ *æ¯æ¬¡* æ¸²æŸ“æ—¶æ‰§è¡Œã€‚*ä½†æ›´å¤šæ—¶å€™ï¼Œå¹¶ä¸éœ€è¦æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™éƒ½æ‰§è¡Œ Effect*ã€‚
+ æœ‰æ—¶è¿™ä¼šæ‹–æ…¢è¿è¡Œé€Ÿåº¦ã€‚å› ä¸ºä¸å¤–éƒ¨ç³»ç»Ÿçš„åŒæ­¥æ“ä½œæ€»æ˜¯æœ‰ä¸€å®šæ—¶è€—ï¼Œåœ¨éå¿…è¦æ—¶å¯èƒ½å¸Œæœ›è·³è¿‡å®ƒã€‚ä¾‹å¦‚ï¼Œæ²¡æœ‰äººä¼šå¸Œæœ›æ¯æ¬¡ç”¨é”®ç›˜æ‰“å­—æ—¶éƒ½é‡æ–°è¿æ¥èŠå¤©æœåŠ¡å™¨ã€‚
+ æœ‰æ—¶è¿™ä¼šå¯¼è‡´ç¨‹åºé€»è¾‘é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œç»„ä»¶çš„æ·¡å…¥åŠ¨ç”»åªéœ€è¦åœ¨ç¬¬ä¸€è½®æ¸²æŸ“å‡ºç°æ—¶æ’­æ”¾ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è§¦å‘æ–°ä¸€è½®æ¸²æŸ“åéƒ½æ’­æ”¾ã€‚

ä¸ºäº†æ¼”ç¤ºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­åŠ å…¥ä¸€äº› `console.log` è¯­å¥å’Œæ›´æ–°çˆ¶ç»„ä»¶ `state` çš„æ–‡æœ¬è¾“å…¥ã€‚è¯·æ³¨æ„é”®å…¥æ˜¯å¦‚ä½•å¯¼è‡´ Effect é‡æ–°è¿è¡Œçš„ï¼š

```jsx
import { useState, useRef, useEffect } from 'react';

function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);

  useEffect(() => {
    if (isPlaying) {
      console.log('è°ƒç”¨ video.play()');
      ref.current.play();
    } else {
      console.log('è°ƒç”¨ video.pause()');
      ref.current.pause();
    }
  });

  return <video ref={ref} src={src} loop playsInline />;
}

export default function App() {
  const [isPlaying, setIsPlaying] = useState(false);
  const [text, setText] = useState('');
  return (
    <>
      <input value={text} onChange={e => setText(e.target.value)} />
      <button onClick={() => setIsPlaying(!isPlaying)}>
        {isPlaying ? 'æš‚åœ' : 'æ’­æ”¾'}
      </button>
      <VideoPlayer
        isPlaying={isPlaying}
        src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      />
    </>
  );
}
```

å°† *ä¾èµ–æ•°ç»„* ä¼ å…¥ `useEffect` çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥å‘Šè¯‰ React è·³è¿‡ä¸å¿…è¦åœ°é‡æ–°è¿è¡Œ Effectã€‚åœ¨ä¸Šé¢ç¤ºä¾‹çš„ç¬¬ 14 è¡Œä¸­ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„ `[]`ï¼š

```jsx
  useEffect(() => {
    // ...
  }, []);
```

ä½ ä¼šå‘ç° React æŠ¥é”™ï¼š`React Hook useEffect has a missing dependency: 'isPlaying'`ï¼š

```jsx
import { useState, useRef, useEffect } from 'react';

function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);

  useEffect(() => {
    if (isPlaying) {
      console.log('è°ƒç”¨ video.play()');
      ref.current.play();
    } else {
      console.log('è°ƒç”¨ video.pause()');
      ref.current.pause();
    }
  }, []); // è¿™å°†äº§ç”Ÿé”™è¯¯

  return <video ref={ref} src={src} loop playsInline />;
}

export default function App() {
  const [isPlaying, setIsPlaying] = useState(false);
  const [text, setText] = useState('');
  return (
    <>
      <input value={text} onChange={e => setText(e.target.value)} />
      <button onClick={() => setIsPlaying(!isPlaying)}>
        {isPlaying ? 'Pause' : 'Play'}
      </button>
      <VideoPlayer
        isPlaying={isPlaying}
        src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      />
    </>
  );
}
```

é—®é¢˜å‡ºç°åœ¨ Effect ä¸­ä½¿ç”¨äº† `isPlaying` prop ä»¥æ§åˆ¶é€»è¾‘ï¼Œä½†åˆæ²¡æœ‰ç›´æ¥å‘Šè¯‰ Effect éœ€è¦ä¾èµ–è¿™ä¸ªå±æ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°† `isPlaying` æ·»åŠ è‡³ä¾èµ–æ•°ç»„ä¸­ï¼š

```jsx
  useEffect(() => {
    if (isPlaying) { // isPlaying åœ¨æ­¤å¤„ä½¿ç”¨â€¦â€¦
      // ...
    } else {
      // ...
    }
  }, [isPlaying]); // â€¦â€¦æ‰€ä»¥å®ƒå¿…é¡»åœ¨æ­¤å¤„å£°æ˜ï¼
```

ç°åœ¨æ‰€æœ‰çš„ä¾èµ–éƒ½å·²ç»å£°æ˜ï¼Œæ‰€ä»¥æ²¡æœ‰é”™è¯¯äº†ã€‚æŒ‡å®š `[isPlaying]` ä¼šå‘Šè¯‰ Reactï¼Œå¦‚æœ `isPlaying` åœ¨ä¸Šä¸€æ¬¡æ¸²æŸ“æ—¶ä¸å½“å‰ç›¸åŒï¼Œå®ƒåº”è¯¥è·³è¿‡é‡æ–°è¿è¡Œ Effectã€‚é€šè¿‡è¿™ä¸ªæ”¹å˜ï¼Œè¾“å…¥æ¡†çš„è¾“å…¥ä¸ä¼šå¯¼è‡´ Effect é‡æ–°è¿è¡Œï¼Œä½†æ˜¯æŒ‰ä¸‹æ’­æ”¾/æš‚åœæŒ‰é’®ä¼šé‡æ–°è¿è¡Œ Effectã€‚

```jsx
import { useState, useRef, useEffect } from 'react';

function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);

  useEffect(() => {
    if (isPlaying) {
      console.log('Calling video.play()');
      ref.current.play();
    } else {
      console.log('Calling video.pause()');
      ref.current.pause();
    }
  }, [isPlaying]);

  return <video ref={ref} src={src} loop playsInline />;
}

export default function App() {
  const [isPlaying, setIsPlaying] = useState(false);
  const [text, setText] = useState('');
  return (
    <>
      <input value={text} onChange={e => setText(e.target.value)} />
      <button onClick={() => setIsPlaying(!isPlaying)}>
        {isPlaying ? 'Pause' : 'Play'}
      </button>
      <VideoPlayer
        isPlaying={isPlaying}
        src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      />
    </>
  );
}
```

ä¾èµ–æ•°ç»„å¯ä»¥åŒ…å«å¤šä¸ªä¾èµ–é¡¹ã€‚å½“æŒ‡å®šçš„æ‰€æœ‰ä¾èµ–é¡¹åœ¨ä¸Šä¸€æ¬¡æ¸²æŸ“æœŸé—´çš„å€¼ä¸å½“å‰å€¼å®Œå…¨ç›¸åŒæ—¶ï¼ŒReact ä¼šè·³è¿‡é‡æ–°è¿è¡Œè¯¥ Effectã€‚React ä½¿ç”¨ Object.is æ¯”è¾ƒä¾èµ–é¡¹çš„å€¼ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… useEffect å‚è€ƒæ–‡æ¡£ã€‚

*è¯·æ³¨æ„ï¼Œä¸èƒ½éšæ„é€‰æ‹©ä¾èµ–é¡¹*ã€‚å¦‚æœä½ æŒ‡å®šçš„ä¾èµ–é¡¹ä¸èƒ½ä¸ Effect ä»£ç æ‰€æœŸæœ›çš„ç›¸åŒ¹é…æ—¶ï¼Œlint å°†ä¼šæŠ¥é”™ï¼Œè¿™å°†å¸®åŠ©ä½ æ‰¾åˆ°ä»£ç ä¸­çš„é—®é¢˜ã€‚å¦‚æœä½ å¸Œæœ›é‡å¤æ‰§è¡Œï¼Œé‚£ä¹ˆä½ åº”å½“ é‡æ–°ç¼–è¾‘ Effect ä»£ç æœ¬èº«ï¼Œä½¿å…¶ä¸éœ€è¦è¯¥ä¾èµ–é¡¹ã€‚

### é™·é˜±
æ²¡æœ‰ä¾èµ–æ•°ç»„ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸ä¾èµ–æ•°ç»„ä½ç©ºæ•°ç»„ `[]` çš„è¡Œä¸ºæ˜¯ä¸ä¸€è‡´çš„ï¼š

```jsx
useEffect(() => {
  // è¿™é‡Œçš„ä»£ç ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åæ‰§è¡Œ
});
```

```jsx
useEffect(() => {
  // è¿™é‡Œçš„ä»£ç åªä¼šåœ¨ç»„ä»¶æŒ‚è½½åæ‰§è¡Œ
}, []);
```

```jsx
useEffect(() => {
  //è¿™é‡Œçš„ä»£ç åªä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åï¼Œå¹¶ä¸” a æˆ– b çš„å€¼ä¸ä¸Šæ¬¡æ¸²æŸ“ä¸ä¸€è‡´æ—¶æ‰§è¡Œ
}, [a, b]);
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥ä»‹ç»ä»€ä¹ˆæ˜¯ *æŒ‚è½½ï¼ˆmountï¼‰*ã€‚

### ä¸ºä»€ä¹ˆä¾èµ–æ•°ç»„ä¸­å¯ä»¥çœç•¥ ref? 
ä¸‹é¢çš„ Effect åŒæ—¶ä½¿ç”¨äº† `ref` ä¸ `isPlaying` propï¼Œä½†æ˜¯åªæœ‰ `isPlaying` è¢«å£°æ˜ä¸ºäº†ä¾èµ–é¡¹ï¼š

```jsx
function VideoPlayer({ src, isPlaying }) {
    const ref = useRef(null);
    useEffect(() => {
        if (isPlaying) {
            ref.current.play();
        } else {
            ref.current.pause();
        }
    }, [isPlaying]);
}
```

è¿™æ˜¯å› ä¸º `ref` å…·æœ‰ ç¨³å®š çš„æ ‡è¯†ï¼šReact ä¿è¯ æ¯è½®æ¸²æŸ“ä¸­è°ƒç”¨ `useRef` æ‰€äº§ç”Ÿçš„å¼•ç”¨å¯¹è±¡æ—¶ï¼Œè·å–åˆ°çš„å¯¹è±¡å¼•ç”¨æ€»æ˜¯ç›¸åŒçš„ï¼Œå³è·å–åˆ°çš„å¯¹è±¡å¼•ç”¨æ°¸è¿œä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥å®ƒä¸ä¼šå¯¼è‡´é‡æ–°è¿è¡Œ Effectã€‚å› æ­¤ï¼Œä¾èµ–æ•°ç»„ä¸­æ˜¯å¦åŒ…å«å®ƒå¹¶ä¸é‡è¦ã€‚å½“ç„¶ä¹Ÿå¯ä»¥åŒ…æ‹¬å®ƒï¼Œè¿™æ ·ä¹Ÿå¯ä»¥ï¼š

```jsx
function VideoPlayer({ src, isPlaying }) {
    const ref = useRef(null);
    useEffect(() => {
        if (isPlaying) {
            ref.current.play();
        } else {
            ref.current.pause();
        }
    }, [isPlaying, ref]);
}
```

`useState` è¿”å›çš„ `set` å‡½æ•° ä¹Ÿæœ‰ç¨³å®šçš„æ ‡è¯†ç¬¦ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥æŠŠå®ƒä»ä¾èµ–æ•°ç»„ä¸­å¿½ç•¥æ‰ã€‚å¦‚æœåœ¨å¿½ç•¥æŸä¸ªä¾èµ–é¡¹æ—¶ linter ä¸ä¼šæŠ¥é”™ï¼Œé‚£ä¹ˆè¿™ä¹ˆåšå°±æ˜¯å®‰å…¨çš„ã€‚
ä½†æ˜¯ï¼Œä»…åœ¨ linter å¯ä»¥â€œçœ‹åˆ°â€å¯¹è±¡ç¨³å®šæ—¶ï¼Œå¿½ç•¥ç¨³å®šä¾èµ–é¡¹çš„è§„åˆ™æ‰ä¼šèµ·ä½œç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ `ref` æ˜¯ä»çˆ¶ç»„ä»¶ä¼ é€’çš„ï¼Œåˆ™å¿…é¡»åœ¨ä¾èµ–é¡¹æ•°ç»„ä¸­æŒ‡å®šå®ƒã€‚è¿™æ ·åšæ˜¯åˆé€‚çš„ï¼Œå› ä¸ºæ— æ³•ç¡®å®šçˆ¶ç»„ä»¶æ˜¯å¦å§‹ç»ˆæ˜¯ä¼ é€’ç›¸åŒçš„ `ref`ï¼Œæˆ–è€…å¯èƒ½æ˜¯æœ‰æ¡ä»¶åœ°ä¼ é€’å‡ ä¸ª `ref` ä¹‹ä¸€ã€‚å› æ­¤ï¼Œä½ çš„ Effect å°†å–å†³äºä¼ é€’çš„æ˜¯å“ªä¸ª `ref`ã€‚

### ç¬¬ä¸‰éƒ¨ï¼šæŒ‰éœ€æ·»åŠ æ¸…ç†ï¼ˆcleanupï¼‰å‡½æ•° 
è€ƒè™‘ä¸€ä¸ªä¸åŒçš„ä¾‹å­ã€‚ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª `ChatRoom` ç»„ä»¶ï¼Œè¯¥ç»„ä»¶å‡ºç°æ—¶éœ€è¦è¿æ¥åˆ°èŠå¤©æœåŠ¡å™¨ã€‚ç°åœ¨ä¸ºä½ æä¾›äº† `createConnection()` APIï¼Œè¯¥ API è¿”å›ä¸€ä¸ªåŒ…å« `connect()` ä¸ `disconnection()` æ–¹æ³•çš„å¯¹è±¡ã€‚è€ƒè™‘å½“ç»„ä»¶å±•ç¤ºç»™ç”¨æˆ·æ—¶ï¼Œåº”è¯¥å¦‚ä½•ä¿æŒè¿æ¥ï¼Ÿ

ä»ç¼–å†™ `Effect` é€»è¾‘å¼€å§‹ï¼š

```jsx
useEffect(() => {
  const connection = createConnection();
  connection.connect();
});
```

æ¯æ¬¡é‡æ–°æ¸²æŸ“åè¿æ¥åˆ°èŠå¤©å®¤ä¼šå¾ˆæ…¢ï¼Œå› æ­¤å¯ä»¥æ·»åŠ ä¾èµ–æ•°ç»„ï¼š

```jsx
useEffect(() => {
  const connection = createConnection();
  connection.connect();
}, []);
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒEffect ä¸­çš„ä»£ç æ²¡æœ‰ä½¿ç”¨ä»»ä½• `props` æˆ– `state`ï¼Œæ­¤æ—¶æŒ‡å®šä¾èµ–æ•°ç»„ä¸ºç©ºæ•°ç»„ `[]`ã€‚è¿™å‘Šè¯‰ React ä»…åœ¨ç»„ä»¶â€œæŒ‚è½½â€æ—¶è¿è¡Œæ­¤ä»£ç ï¼Œå³é¦–æ¬¡å‡ºç°åœ¨å±å¹•ä¸Šè¿™ä¸€é˜¶æ®µã€‚

è¯•è¯•è¿è¡Œä¸‹é¢çš„ä»£ç ï¼š

#### App.js
```jsx
import { useEffect } from 'react';
import { createConnection } from './chat.js';

export default function ChatRoom() {
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
  }, []);
  return <h1>æ¬¢è¿æ¥åˆ°èŠå¤©å®¤ï¼</h1>;
}
```

#### chat.js
```jsx
export function createConnection() {
  // çœŸå®çš„å®ç°ä¼šå°†å…¶è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œæ­¤å¤„ä»£ç åªæ˜¯ç¤ºä¾‹
  return {
    connect() {
      console.log('âœ… è¿æ¥ä¸­â€¦â€¦');
    },
    disconnect() {
      console.log('âŒ è¿æ¥æ–­å¼€ã€‚');
    }
  };
}
```

è¿™é‡Œçš„ Effect ä»…åœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œï¼Œæ‰€ä»¥ "âœ… è¿æ¥ä¸­â€¦â€¦" åœ¨æ§åˆ¶å°ä¸­åªä¼šæ‰“å°ä¸€æ¬¡ã€‚ç„¶è€Œæ§åˆ¶å°å®é™…æ‰“å° "âœ… è¿æ¥ä¸­â€¦â€¦" äº†ä¸¤æ¬¡ï¼ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

æƒ³è±¡ `ChatRoom` ç»„ä»¶æ˜¯ä¸€ä¸ªå¤§è§„æ¨¡çš„ App ä¸­è®¸å¤šç•Œé¢ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ç”¨æˆ·åˆ‡æ¢åˆ°å«æœ‰ `ChatRoom` ç»„ä»¶çš„é¡µé¢ä¸Šæ—¶ï¼Œè¯¥ç»„ä»¶è¢«æŒ‚è½½ï¼Œå¹¶è°ƒç”¨ `connection.connect()` æ–¹æ³•è¿æ¥æœåŠ¡å™¨ã€‚ç„¶åæƒ³è±¡ç”¨æˆ·æ­¤æ—¶çªç„¶å¯¼èˆªåˆ°å¦ä¸€ä¸ªé¡µé¢ï¼Œæ¯”å¦‚åˆ‡æ¢åˆ°â€œè®¾ç½®â€é¡µé¢ã€‚è¿™æ—¶ï¼Œ`ChatRoom` ç»„ä»¶å°±è¢«å¸è½½äº†ã€‚æ¥ä¸‹æ¥ï¼Œç”¨æˆ·åœ¨â€œè®¾ç½®â€é¡µé¢å¿™å®Œåï¼Œå•å‡»â€œè¿”å›â€ï¼Œå›åˆ°ä¸Šä¸€ä¸ªé¡µé¢ï¼Œå¹¶å†æ¬¡æŒ‚è½½ `ChatRoom`ã€‚è¿™å°†å»ºç«‹ç¬¬äºŒæ¬¡è¿æ¥ï¼Œä½†æ˜¯ï¼Œç¬¬ä¸€æ¬¡æ—¶åˆ›å»ºçš„è¿æ¥ä»æœªè¢«é”€æ¯ï¼å½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºä¸­ä¸æ–­åˆ‡æ¢ç•Œé¢å†è¿”å›æ—¶ï¼Œä¸æœåŠ¡å™¨çš„è¿æ¥ä¼šä¸æ–­å †ç§¯ã€‚

å¦‚æœä¸è¿›è¡Œå¤§é‡çš„æ‰‹åŠ¨æµ‹è¯•ï¼Œè¿™æ ·çš„é”™è¯¯å¾ˆå®¹æ˜“è¢«é—æ¼ã€‚ä¸ºäº†å¸®åŠ©ä½ å¿«é€Ÿå‘ç°å®ƒä»¬ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒReact ä¼šåœ¨åˆå§‹æŒ‚è½½ç»„ä»¶åï¼Œç«‹å³å†æŒ‚è½½ä¸€æ¬¡ã€‚

è§‚å¯Ÿåˆ° "âœ… è¿æ¥ä¸­â€¦â€¦" å‡ºç°äº†ä¸¤æ¬¡ï¼Œå¯ä»¥å¸®åŠ©æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼šåœ¨ä»£ç ä¸­ï¼Œç»„ä»¶è¢«å¸è½½æ—¶æ²¡æœ‰å…³é—­è¿æ¥ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨ Effect ä¸­è¿”å›ä¸€ä¸ª *æ¸…ç†ï¼ˆcleanupï¼‰* å‡½æ•°ã€‚

```jsx
useEffect(() => {
    const connection = createConnection();
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, []);
```

æ¯æ¬¡é‡æ–°æ‰§è¡Œ Effect ä¹‹å‰ï¼ŒReact éƒ½ä¼šè°ƒç”¨æ¸…ç†å‡½æ•°ï¼›ç»„ä»¶è¢«å¸è½½æ—¶ï¼Œä¹Ÿä¼šè°ƒç”¨æ¸…ç†å‡½æ•°ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æ‰§è¡Œæ¸…ç†å‡½æ•°ä¼šåšäº›ä»€ä¹ˆï¼š

#### App.js

```jsx
import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';

export default function ChatRoom() {
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, []);
  return <h1>æ¬¢è¿æ¥åˆ°èŠå¤©å®¤ï¼</h1>;
}
```

ç°åœ¨åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œæ§åˆ¶å°ä¼šæ‰“å°ä¸‰æ¡è®°å½•ï¼š
1. "âœ… è¿æ¥ä¸­â€¦â€¦"
2. "âŒ è¿æ¥æ–­å¼€ã€‚"
3. "âœ… è¿æ¥ä¸­â€¦â€¦"

*åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œå‡ºç°è¿™æ ·çš„ç»“æœæ‰æ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚* é‡å¤æŒ‚è½½ç»„ä»¶ï¼Œå¯ä»¥ç¡®ä¿åœ¨ React ä¸­ç¦»å¼€å’Œè¿”å›é¡µé¢æ—¶ä¸ä¼šå¯¼è‡´ä»£ç è¿è¡Œå‡ºç°é—®é¢˜ã€‚ä¸Šé¢çš„ä»£ç ä¸­è§„å®šäº†æŒ‚è½½ç»„ä»¶æ—¶è¿æ¥æœåŠ¡å™¨ã€å¸è½½ç»„ä»¶æ—¶æ–­è¿æœåŠ¡å™¨ã€‚æ‰€ä»¥æ–­å¼€ã€è¿æ¥å†é‡æ–°è¿æ¥æ˜¯ç¬¦åˆé¢„æœŸçš„è¡Œä¸ºã€‚å½“ä¸º Effect æ­£ç¡®å®ç°æ¸…ç†å‡½æ•°æ—¶ï¼Œæ— è®º Effect æ‰§è¡Œä¸€æ¬¡ï¼Œè¿˜æ˜¯æ‰§è¡Œã€æ¸…ç†ã€å†æ‰§è¡Œï¼Œç”¨æˆ·éƒ½ä¸ä¼šæ„Ÿå—åˆ°æ˜æ˜¾çš„å·®å¼‚ã€‚æ‰€ä»¥ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œå‡ºç°é¢å¤–çš„è¿æ¥ã€æ–­è¿æ—¶ï¼Œè¿™æ˜¯ React æ­£åœ¨è°ƒè¯•ä½ çš„ä»£ç ã€‚è¿™æ˜¯å¾ˆæ­£å¸¸çš„ç°è±¡ï¼Œä¸è¦è¯•å›¾æ¶ˆé™¤å®ƒï¼

*åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œ"âœ… è¿æ¥ä¸­â€¦â€¦" åªä¼šè¢«æ‰“å°ä¸€æ¬¡ã€‚* ä¹Ÿå°±æ˜¯è¯´ä»…åœ¨å¼€å‘ç¯å¢ƒä¸‹æ‰ä¼šé‡å¤æŒ‚è½½ç»„ä»¶ï¼Œä»¥å¸®åŠ©ä½ æ‰¾åˆ°éœ€è¦æ¸…ç†çš„ Effectã€‚ä½ å¯ä»¥é€‰æ‹©å…³é—­ ä¸¥æ ¼æ¨¡å¼ æ¥å…³é—­å¼€å‘ç¯å¢ƒä¸‹ç‰¹æœ‰çš„è¡Œä¸ºï¼Œä½†æˆ‘ä»¬å»ºè®®ä¿ç•™å®ƒã€‚è¿™å¯ä»¥å¸®åŠ©å‘ç°è®¸å¤šä¸Šé¢è¿™æ ·çš„é”™è¯¯ã€‚

## å¦‚ä½•å¤„ç†åœ¨å¼€å‘ç¯å¢ƒä¸­ Effect æ‰§è¡Œä¸¤æ¬¡ï¼Ÿ 
åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒReact æœ‰æ„é‡å¤æŒ‚è½½ä½ çš„ç»„ä»¶ï¼Œä»¥æŸ¥æ‰¾åƒä¸Šé¢ç¤ºä¾‹ä¸­çš„é”™è¯¯ã€‚*æ­£ç¡®çš„æ€åº¦æ˜¯â€œå¦‚ä½•ä¿®å¤ Effect ä»¥ä¾¿å®ƒåœ¨é‡å¤æŒ‚è½½åèƒ½æ­£å¸¸å·¥ä½œâ€ï¼Œè€Œä¸æ˜¯â€œå¦‚ä½•åªè¿è¡Œä¸€æ¬¡ Effectâ€ã€‚*

é€šå¸¸çš„è§£å†³åŠæ³•æ˜¯å®ç°æ¸…ç†å‡½æ•°ã€‚æ¸…ç†å‡½æ•°åº”è¯¥åœæ­¢æˆ–æ’¤é”€ Effect æ­£åœ¨æ‰§è¡Œçš„ä»»ä½•æ“ä½œã€‚ç®€å•æ¥è¯´ï¼Œç”¨æˆ·ä¸åº”è¯¥æ„Ÿå—åˆ° Effect åªæ‰§è¡Œä¸€æ¬¡ï¼ˆå¦‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼‰å’Œæ‰§è¡Œâ€œæŒ‚è½½ â†’ æ¸…ç† â†’ æŒ‚è½½â€è¿‡ç¨‹ï¼ˆå¦‚åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼‰ä¹‹é—´çš„å·®å¼‚ã€‚

ä¸‹é¢æä¾›ä¸€äº›å¸¸ç”¨çš„ Effect åº”ç”¨æ¨¡å¼ã€‚

### æ§åˆ¶é React ç»„ä»¶ 
æœ‰æ—¶éœ€è¦æ·»åŠ ä¸æ˜¯ä½¿ç”¨ React ç¼–å†™çš„ UI å°éƒ¨ä»¶ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ è¦å‘é¡µé¢æ·»åŠ åœ°å›¾ç»„ä»¶ï¼Œå¹¶ä¸”å®ƒæœ‰ä¸€ä¸ª `setZoomLevel()` æ–¹æ³•ï¼Œä½ å¸Œæœ›è°ƒæ•´ç¼©æ”¾çº§åˆ«ï¼ˆzoom levelï¼‰å¹¶ä¸ React ä»£ç ä¸­çš„ `zoomLevel` `state` å˜é‡ä¿æŒåŒæ­¥ã€‚Effect çœ‹èµ·æ¥åº”è¯¥ä¸ä¸‹é¢ç±»ä¼¼ï¼š

```jsx
useEffect(() => {
  const map = mapRef.current;
  map.setZoomLevel(zoomLevel);
}, [zoomLevel]);
```

è¯·æ³¨æ„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸éœ€è¦æ¸…ç†ã€‚åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒReact ä¼šè°ƒç”¨ Effect ä¸¤æ¬¡ï¼Œä½†è¿™ä¸¤æ¬¡æŒ‚è½½æ—¶ä¾èµ–é¡¹ setZoomLevel éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥ä¼šè·³è¿‡æ‰§è¡Œç¬¬äºŒæ¬¡æŒ‚è½½æ—¶çš„ Effectã€‚å¼€å‘ç¯å¢ƒä¸­å®ƒå¯èƒ½ä¼šç¨å¾®æ…¢ä¸€äº›ï¼Œä½†è¿™é—®é¢˜ä¸å¤§ï¼Œå› ä¸ºå®ƒåœ¨ç”Ÿäº§ä¸­ä¸ä¼šè¿›è¡Œä¸å¿…è¦çš„é‡å¤æŒ‚è½½ã€‚

æŸäº› API å¯èƒ½ä¸å…è®¸è¿ç»­è°ƒç”¨ä¸¤æ¬¡ã€‚ä¾‹å¦‚ï¼Œå†…ç½®çš„ `<dialog>` å…ƒç´ çš„ `showModal` æ–¹æ³•åœ¨è¿ç»­è°ƒç”¨ä¸¤æ¬¡æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ­¤æ—¶å®ç°æ¸…ç†å‡½æ•°å¹¶ä½¿å…¶å…³é—­å¯¹è¯æ¡†ï¼š

```jsx
useEffect(() => {
    const dialog = dialogRef.current;
    dialog.showModal();
    return () => dialog.close();
}, []);
```

åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒEffect å°†è°ƒç”¨ `showModal()`ï¼Œç„¶åç«‹å³è°ƒç”¨ `close()`ï¼Œç„¶åå†æ¬¡è°ƒç”¨ `showModal()`ã€‚è¿™ä¸è°ƒç”¨åªä¸€æ¬¡ `showModal()` çš„æ•ˆæœç›¸åŒã€‚ä¹Ÿæ­£å¦‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚

### è®¢é˜…äº‹ä»¶ 
å¦‚æœ Effect è®¢é˜…äº†æŸäº›äº‹ä»¶ï¼Œæ¸…ç†å‡½æ•°åº”è¯¥é€€è®¢è¿™äº›äº‹ä»¶ï¼š

```jsx
useEffect(() => {
  function handleScroll(e) {
    console.log(window.scrollX, window.scrollY);
  }
  window.addEventListener('scroll', handleScroll);
  return () => window.removeEventListener('scroll', handleScroll);
}, []);
```

åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒEffect ä¼šè°ƒç”¨ `addEventListener()`ï¼Œç„¶åç«‹å³è°ƒç”¨ `removeEventListener()`ï¼Œç„¶åå†è°ƒç”¨ç›¸åŒçš„ `addEventListener()`ï¼Œè¿™ä¸åªè®¢é˜…ä¸€æ¬¡äº‹ä»¶çš„ Effect ç­‰æ•ˆï¼›è¿™ä¹Ÿä¸ç”¨æˆ·åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åªè°ƒç”¨ä¸€æ¬¡ `addEventListener()` å…·æœ‰ç›¸åŒçš„æ„ŸçŸ¥æ•ˆæœã€‚

### è§¦å‘åŠ¨ç”» 
å¦‚æœ Effect å¯¹æŸäº›å†…å®¹åŠ å…¥äº†åŠ¨ç”»ï¼Œæ¸…ç†å‡½æ•°åº”å°†åŠ¨ç”»é‡ç½®ï¼š

```jsx
useEffect(() => {
  const node = ref.current;
  node.style.opacity = 1; // è§¦å‘åŠ¨ç”»
  return () => {
    node.style.opacity = 0; // é‡ç½®ä¸ºåˆå§‹å€¼
  };
}, []);
```

åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œé€æ˜åº¦ç”± 1 å˜ä¸º 0ï¼Œå†å˜ä¸º 1ã€‚è¿™ä¸åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç›´æ¥å°†å…¶è®¾ç½®ä¸º 1 å…·æœ‰ç›¸åŒçš„æ„ŸçŸ¥æ•ˆæœï¼Œå¦‚æœä½ ä½¿ç”¨æ”¯æŒè¿‡æ¸¡çš„ç¬¬ä¸‰æ–¹åŠ¨ç”»åº“ï¼Œä½ çš„æ¸…ç†å‡½æ•°åº”å°†æ—¶é—´è½´é‡ç½®ä¸ºå…¶åˆå§‹çŠ¶æ€ã€‚

### è·å–æ•°æ® 
å¦‚æœ Effect å°†ä¼šè·å–æ•°æ®ï¼Œæ¸…ç†å‡½æ•°åº”è¯¥è¦ä¹ˆ ä¸­æ­¢è¯¥æ•°æ®è·å–æ“ä½œï¼Œè¦ä¹ˆå¿½ç•¥å…¶ç»“æœï¼š

```jsx
useEffect(() => {
  let ignore = false;

  async function startFetching() {
    const json = await fetchTodos(userId);
    if (!ignore) {
      setTodos(json);
    }
  }

  startFetching();

  return () => {
    ignore = true;
  };
}, [userId]);
```

æˆ‘ä»¬æ— æ³•æ’¤æ¶ˆå·²ç»å‘ç”Ÿçš„ç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯æ¸…ç†å‡½æ•°åº”å½“ç¡®ä¿è·å–æ•°æ®çš„è¿‡ç¨‹ä»¥åŠè·å–åˆ°çš„ç»“æœä¸ä¼šç»§ç»­å½±å“ç¨‹åºè¿è¡Œã€‚å¦‚æœ `userId` ä» `'Alice'` å˜ä¸º `'Bob'`ï¼Œé‚£ä¹ˆè¯·ç¡®ä¿ `'Alice'` å“åº”æ•°æ®è¢«å¿½ç•¥ï¼Œå³ä½¿å®ƒåœ¨ `'Bob'` ä¹‹ååˆ°è¾¾ã€‚

*åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæµè§ˆå™¨è°ƒè¯•å·¥å…·çš„â€œç½‘ç»œâ€é€‰é¡¹å¡ä¸­ä¼šå‡ºç°ä¸¤ä¸ª fetch è¯·æ±‚ã€‚* è¿™æ˜¯æ­£å¸¸çš„ã€‚ä½¿ç”¨ä¸Šè¿°æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ª Effect å°†ç«‹å³è¢«æ¸…ç†ï¼Œè€Œ `ignore` å°†è¢«è®¾ç½®ä¸º `true`ã€‚å› æ­¤ï¼Œå³ä½¿æœ‰é¢å¤–çš„è¯·æ±‚ï¼Œç”±äºæœ‰ `if (!ignore)` åˆ¤æ–­æ£€æŸ¥ï¼Œä¹Ÿä¸ä¼šå½±å“ç¨‹åºçŠ¶æ€ã€‚

*åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåªä¼šæ˜¾ç¤ºå‘é€äº†ä¸€æ¡è·å–è¯·æ±‚ã€‚* å¦‚æœå¼€å‘ç¯å¢ƒä¸­ï¼Œç¬¬äºŒæ¬¡è¯·æ±‚ç»™ä½ é€ æˆäº†å›°æ‰°ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ç§å¯ä»¥åˆ é™¤é‡å¤è¯·æ±‚ã€å¹¶ç¼“å­˜è¯·æ±‚å“åº”çš„è§£å†³æ–¹æ¡ˆï¼š

```jsx
function TodoList() {
    const todos = useSomeDataLibrary(`/api/user/${userId}/todos`);
    // ...
}
```

è¿™ä¸ä»…å¯ä»¥æé«˜å¼€å‘ä½“éªŒï¼Œè¿˜å¯ä»¥è®©ä½ çš„åº”ç”¨ç¨‹åºé€Ÿåº¦æ›´å¿«ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·æŒ‰ä¸‹æŒ‰é’®æ—¶ï¼Œå¦‚æœæ•°æ®å·²ç»è¢«ç¼“å­˜äº†ï¼Œé‚£ä¹ˆå°±ä¸å¿…å†æ¬¡ç­‰å¾…åŠ è½½ã€‚ä½ å¯ä»¥è‡ªå·±æ„å»ºè¿™æ ·çš„ç¼“å­˜ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¾ˆå¤šåœ¨ Effect ä¸­æ‰‹åŠ¨åŠ è½½æ•°æ®çš„æ›¿ä»£æ–¹æ³•ã€‚

### Effect ä¸­æœ‰å“ªäº›å¥½çš„æ•°æ®è·å–æ›¿ä»£æ–¹æ¡ˆï¼Ÿ 
åœ¨ Effect ä¸­è°ƒç”¨ `fetch` è¯·æ±‚æ•°æ® æ˜¯ä¸€ç§éå¸¸å—æ¬¢è¿çš„æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯åœ¨å®¢æˆ·ç«¯åº”ç”¨ä¸­ã€‚ç„¶è€Œï¼Œå®ƒéå¸¸ä¾èµ–æ‰‹åŠ¨æ“ä½œï¼Œæœ‰å¾ˆå¤šçš„ç¼ºç‚¹ï¼š
+ *Effect ä¸èƒ½åœ¨æœåŠ¡ç«¯æ‰§è¡Œ*ã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨æœ€åˆä¼ é€’çš„ HTML ä¸ä¼šåŒ…å«ä»»ä½•æ•°æ®ã€‚å®¢æˆ·ç«¯çš„æµè§ˆå™¨å¿…é¡»ä¸‹è½½æ‰€æœ‰ JavaScript è„šæœ¬æ¥æ¸²æŸ“åº”ç”¨ç¨‹åºï¼Œç„¶åæ‰èƒ½åŠ è½½æ•°æ®â€”â€”è¿™å¹¶ä¸æç¬‘ã€‚
+ *ç›´æ¥åœ¨ Effect ä¸­è·å–æ•°æ®å®¹æ˜“äº§ç”Ÿç½‘ç»œç€‘å¸ƒï¼ˆnetwork waterfallï¼‰*ã€‚é¦–å…ˆæ¸²æŸ“äº†çˆ¶ç»„ä»¶ï¼Œå®ƒä¼šè·å–ä¸€äº›æ•°æ®å¹¶è¿›è¡Œæ¸²æŸ“ï¼›ç„¶åæ¸²æŸ“å­ç»„ä»¶ï¼Œæ¥ç€å­ç»„ä»¶å¼€å§‹è·å–å®ƒä»¬çš„æ•°æ®ã€‚å¦‚æœç½‘ç»œé€Ÿåº¦ä¸å¤Ÿå¿«ï¼Œè¿™ç§æ–¹å¼æ¯”åŒæ—¶è·å–æ‰€æœ‰æ•°æ®è¦æ…¢å¾—å¤šã€‚
+ *ç›´æ¥åœ¨ Effect ä¸­è·å–æ•°æ®é€šå¸¸æ„å‘³ç€æ— æ³•é¢„åŠ è½½æˆ–ç¼“å­˜æ•°æ®*ã€‚ä¾‹å¦‚ï¼Œåœ¨ç»„ä»¶å¸è½½åç„¶åå†æ¬¡æŒ‚è½½ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»å†æ¬¡è·å–æ•°æ®ã€‚
+ *è¿™ä¸æ˜¯å¾ˆç¬¦åˆäººæœºäº¤äº’åŸåˆ™*ã€‚å¦‚æœä½ ä¸æƒ³å‡ºç°åƒ æ¡ä»¶ç«äº‰ï¼ˆrace conditionï¼‰ ä¹‹ç±»çš„é—®é¢˜ï¼Œé‚£ä¹ˆä½ éœ€è¦ç¼–å†™æ›´å¤šçš„æ ·æ¿ä»£ç ã€‚

ä»¥ä¸Šæ‰€åˆ—å‡ºæ¥çš„ç¼ºç‚¹å¹¶ä¸æ˜¯ React ç‰¹æœ‰çš„ã€‚åœ¨ä»»ä½•æ¡†æ¶æˆ–è€…åº“ä¸Šçš„ç»„ä»¶æŒ‚è½½è¿‡ç¨‹ä¸­è·å–æ•°æ®ï¼Œéƒ½ä¼šé‡åˆ°è¿™äº›é—®é¢˜ã€‚ä¸è·¯ç”±ä¸€æ ·ï¼Œè¦åšå¥½æ•°æ®è·å–å¹¶éæ˜“äº‹ï¼Œå› æ­¤æˆ‘ä»¬æ¨èä»¥ä¸‹æ–¹æ³•ï¼š
+ *å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ æ¡†æ¶* ï¼Œä½¿ç”¨å…¶å†…ç½®çš„æ•°æ®è·å–æœºåˆ¶ã€‚ç°ä»£ React æ¡†æ¶é›†æˆäº†é«˜æ•ˆçš„æ•°æ®è·å–æœºåˆ¶ï¼Œä¸ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜ã€‚
+ *å¦åˆ™ï¼Œè¯·è€ƒè™‘ä½¿ç”¨æˆ–æ„å»ºå®¢æˆ·ç«¯ç¼“å­˜*ã€‚ç›®å‰å—æ¬¢è¿çš„å¼€æºè§£å†³æ–¹æ¡ˆæ˜¯ React Queryã€useSWR å’Œ React Router v6.4+ã€‚ä½ ä¹Ÿå¯ä»¥æ„å»ºè‡ªå·±çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åœ¨å¹•åä½¿ç”¨ Effectï¼Œä½†æ˜¯è¯·æ³¨æ„æ·»åŠ ç”¨äºåˆ é™¤é‡å¤è¯·æ±‚ã€ç¼“å­˜å“åº”å’Œé¿å…ç½‘ç»œç€‘å¸ƒï¼ˆé€šè¿‡é¢„åŠ è½½æ•°æ®æˆ–å°†æ•°æ®éœ€æ±‚æå‡åˆ°è·¯ç”±ï¼‰çš„é€»è¾‘ã€‚

å¦‚æœè¿™äº›æ–¹æ³•éƒ½ä¸é€‚åˆä½ ï¼Œä½ å¯ä»¥ç»§ç»­ç›´æ¥åœ¨ Effect ä¸­è·å–æ•°æ®ã€‚

### å‘é€åˆ†ææŠ¥å‘Š 

```jsx
useEffect(() => {
  logVisit(url); // å‘é€ POST è¯·æ±‚
}, [url]);
```

åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œ`logVisit` ä¼šä¸ºæ¯ä¸ª URL å‘é€ä¸¤æ¬¡è¯·æ±‚ï¼Œæ‰€ä»¥ä½ å¯èƒ½ä¼šæƒ³å°è¯•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚*ä¸è¿‡æˆ‘ä»¬å»ºè®®ä¸å¿…ä¿®æ”¹æ­¤å¤„ä»£ç *ï¼Œä¸å‰é¢çš„ç¤ºä¾‹ä¸€æ ·ï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œè¿è¡Œä¸€æ¬¡å’Œè¿è¡Œä¸¤æ¬¡ä¹‹é—´ä¸ä¼š æ„ŸçŸ¥ åˆ°è¡Œä¸ºå·®å¼‚ã€‚ä»å®é™…çš„è§’åº¦æ¥çœ‹ï¼Œ`logVisit` ä¸åº”è¯¥åœ¨å¼€å‘ç¯å¢ƒä¸­åšä»»ä½•å½±å“ç”Ÿäº§äº‹æƒ…ã€‚ç”±äºæ¯æ¬¡ä¿å­˜ä»£ç æ–‡ä»¶æ—¶éƒ½ä¼šé‡æ–°æŒ‚è½½ç»„ä»¶ï¼Œå› æ­¤åœ¨å¼€å‘ç¯å¢ƒä¸­ä¼šé¢å¤–è®°å½•è®¿é—®æ¬¡æ•°ã€‚

*åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸ä¼šäº§ç”Ÿæœ‰é‡å¤çš„è®¿é—®æ—¥å¿—ã€‚*

ä¸ºäº†è°ƒè¯•å‘é€çš„åˆ†æäº‹ä»¶ï¼Œå¯ä»¥å°†åº”ç”¨éƒ¨ç½²åˆ°ä¸€ä¸ªè¿è¡Œåœ¨ç”Ÿäº§æ¨¡å¼ä¸‹çš„æš‚å­˜ç¯å¢ƒï¼Œæˆ–è€…æš‚æ—¶å–æ¶ˆ ä¸¥æ ¼æ¨¡å¼ åŠå…¶ä»…åœ¨å¼€å‘ç¯å¢ƒä¸­é‡æ–°åŠ è½½æ£€æŸ¥ï¼›è¿˜å¯ä»¥ä»è·¯ç”±å˜æ›´äº‹ä»¶å¤„ç†ç¨‹åºä¸­å‘é€åˆ†ææ•°æ®ï¼Œè€Œä¸æ˜¯ä» Effect ä¸­å‘é€ã€‚ä¸ºäº†æ›´ç²¾ç¡®çš„åˆ†æï¼Œå¯ä»¥ä½¿ç”¨ Intersection Observer æ¥è·Ÿè¸ªå“ªäº›ç»„ä»¶ä½äºè§†å£ä¸­ä»¥åŠå®ƒä»¬ä¿æŒå¯è§çš„æ—¶é—´ã€‚

### åˆå§‹åŒ–åº”ç”¨æ—¶ä¸éœ€è¦ä½¿ç”¨ Effect çš„æƒ…å½¢ 
æŸäº›é€»è¾‘åº”è¯¥åªåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è¿è¡Œä¸€æ¬¡ã€‚æ¯”å¦‚ï¼ŒéªŒè¯ç™»é™†çŠ¶æ€å’ŒåŠ è½½æœ¬åœ°ç¨‹åºæ•°æ®ã€‚ä½ å¯ä»¥å°†å…¶æ”¾åœ¨ç»„ä»¶ä¹‹å¤–ï¼š

```jsx
if (typeof window !== 'undefined') { // æ£€æŸ¥æ˜¯å¦åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ
  checkAuthToken();
  loadDataFromLocalStorage();
}

function App() {
  // â€¦â€¦
}
```

è¿™ä¿è¯äº†è¿™ç§é€»è¾‘åœ¨æµè§ˆå™¨åŠ è½½é¡µé¢ååªè¿è¡Œä¸€æ¬¡ã€‚

### ä¸è¦åœ¨ Effect ä¸­æ‰§è¡Œè´­ä¹°å•†å“ä¸€ç±»çš„æ“ä½œ 
æœ‰æ—¶ï¼Œå³ä½¿ç¼–å†™äº†ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œä¹Ÿä¸èƒ½é¿å…æ‰§è¡Œä¸¤æ¬¡ Effectã€‚ä¾‹å¦‚ï¼ŒEffect åŒ…å«ä¼šå‘é€ POST è¯·æ±‚ä»¥æ‰§è¡Œè´­ä¹°æ“ä½œï¼š

```jsx
useEffect(() => {
  // ğŸ”´ é”™è¯¯ï¼šæ­¤å¤„çš„ Effect ä¼šåœ¨å¼€å‘ç¯å¢ƒä¸­æ‰§è¡Œä¸¤æ¬¡ï¼Œè¿™åœ¨ä»£ç ä¸­æ˜¯æœ‰é—®é¢˜çš„ã€‚
  fetch('/api/buy', { method: 'POST' });
}, []);
```

ä¸€æ–¹é¢ï¼Œå¼€å‘ç¯å¢ƒä¸‹ï¼ŒEffect ä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œè¿™æ„å‘³ç€è´­ä¹°æ“ä½œæ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œä½†æ˜¯è¿™å¹¶éæ˜¯é¢„æœŸçš„ç»“æœï¼Œæ‰€ä»¥ä¸åº”è¯¥æŠŠè¿™ä¸ªä¸šåŠ¡é€»è¾‘æ”¾åœ¨ Effect ä¸­ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœç”¨æˆ·è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢ï¼Œç„¶åæŒ‰â€œåé€€â€æŒ‰é’®å›åˆ°äº†è¿™ä¸ªç•Œé¢ï¼Œè¯¥æ€ä¹ˆåŠï¼ŸEffect ä¼šéšç€ç»„ä»¶å†æ¬¡æŒ‚è½½è€Œå†æ¬¡æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œå½“ç”¨æˆ·é‡æ–°è®¿é—®æŸä¸ªé¡µé¢æ—¶ï¼Œä¸åº”å½“æ‰§è¡Œè´­ä¹°æ“ä½œï¼›å½“åªæœ‰ç”¨æˆ·ç‚¹å‡»â€œè´­ä¹°â€æŒ‰é’®æ—¶ï¼Œæ‰æ‰§è¡Œè´­ä¹°æ“ä½œã€‚

å› æ­¤ï¼Œâ€œè´­ä¹°â€çš„æ“ä½œä¸åº”ç”±ç»„ä»¶çš„æŒ‚è½½ã€æ¸²æŸ“å¼•èµ·çš„ï¼›å®ƒæ˜¯ç”±ç‰¹å®šçš„äº¤äº’ä½œç”¨å¼•èµ·çš„ï¼Œå®ƒåº”è¯¥åªåœ¨ç”¨æˆ·æŒ‰ä¸‹æŒ‰é’®æ—¶è¿è¡Œã€‚å› æ­¤ï¼Œå®ƒä¸åº”è¯¥å†™åœ¨ Effect ä¸­ï¼Œ*åº”å½“æŠŠ /api/buy è¯·æ±‚æ“ä½œç§»åŠ¨åˆ°è´­ä¹°æŒ‰é’®äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼š*

```jsx
  function handleClick() {
    // âœ… è´­ä¹°å•†å“åº”å½“åœ¨äº‹ä»¶ä¸­æ‰§è¡Œï¼Œå› ä¸ºè¿™æ˜¯ç”±ç‰¹å®šçš„æ“ä½œå¼•èµ·çš„ã€‚
    fetch('/api/buy', { method: 'POST' });
  }
```

*è¿™ä¸ªä¾‹å­è¯´æ˜å¦‚æœé‡æ–°æŒ‚è½½ç ´åäº†ç¨‹åºçš„é€»è¾‘ï¼Œåˆ™é€šå¸¸å«æœ‰æœªè¢«å‘ç°çš„é”™è¯¯ã€‚*ä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œè®¿é—®è¿™ä¸ªé¡µé¢çš„æ•ˆæœï¼Œä¸è®¿é—®è¯¥é¡µé¢æ—¶å•å‡»å’Œé¡µé¢ä¸­å…¶ä»–é“¾æ¥å¹¶æŒ‰ä¸‹åé€€æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚React é€šè¿‡åœ¨å¼€å‘ç¯å¢ƒä¸­é‡å¤æŒ‚è½½ç»„ä»¶æ¥éªŒè¯ç»„ä»¶æ˜¯å¦éµå®ˆæ­¤åŸåˆ™ã€‚

## æ€»ç»“ 
ä¸‹é¢çš„ playground å¯ä»¥å¸®åŠ©ä½ åœ¨å®è·µä¸­æ‰¾åˆ°å¯¹ Effect çš„æ„Ÿè§‰ã€‚

è¿™ä¸ªä¾‹å­ä½¿ç”¨ `setTimeout` æ¥å®‰æ’æ§åˆ¶å°æ—¥å¿—ï¼Œåœ¨ Effect è¿è¡Œåä¸‰ç§’é’Ÿæ˜¾ç¤ºè¾“å…¥æ–‡æœ¬ã€‚æ¸…ç†å‡½æ•°ä¼šå–æ¶ˆæŒ‚èµ·çš„è¶…æ—¶ã€‚ä»æŒ‰ä¸‹â€œæŒ‚è½½ç»„ä»¶â€å¼€å§‹ï¼š

```jsx
import { useState, useEffect } from 'react';

function Playground() {
  const [text, setText] = useState('a');

  useEffect(() => {
    function onTimeout() {
      console.log('â° ' + text);
    }

    console.log('ğŸ”µ å®‰æ’ "' + text + '" æ—¥å¿—');
    const timeoutId = setTimeout(onTimeout, 3000);

    return () => {
      console.log('ğŸŸ¡ å–æ¶ˆ "' + text + '" æ—¥å¿—');
      clearTimeout(timeoutId);
    };
  }, [text]);

  return (
    <>
      <label>
        æ—¥å¿—å†…å®¹ï¼š{' '}
        <input
          value={text}
          onChange={e => setText(e.target.value)}
        />
      </label>
      <h1>{text}</h1>
    </>
  );
}

export default function App() {
  const [show, setShow] = useState(false);
  return (
    <>
      <button onClick={() => setShow(!show)}>
        {show ? 'å¸è½½' : 'æŒ‚è½½'} ç»„ä»¶
      </button>
      {show && <hr />}
      {show && <Playground />}
    </>
  );
}
```